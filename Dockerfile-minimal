# Minimal Ubuntu Sandbox with FastAPI (Memory Optimized)
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive
ENV DISPLAY=:99
ENV API_PORT=8080

# Install only essential packages
RUN apt-get update && apt-get install -y \
    python3 python3-pip \
    xvfb \
    curl \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# Install minimal Python dependencies
RUN pip3 install --no-cache-dir fastapi==0.104.1 uvicorn[standard]==0.24.0 pillow==10.0.1 requests==2.31.0

# Create app directory
WORKDIR /app

# Copy FastAPI server only
COPY app/main.py /app/main.py

# Create minimal startup script
COPY start-minimal.sh /start-minimal.sh
RUN chmod +x /start-minimal.sh

# Expose API port only
EXPOSE 8080

# Use minimal startup
CMD ["/start-minimal.sh"]
